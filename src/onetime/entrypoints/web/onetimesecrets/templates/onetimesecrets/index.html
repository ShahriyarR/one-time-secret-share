{% extends 'onetimesecrets/base.html' %}

{% block content %}
<h1 class="title">{% block title %} Welcome to One Time Secret Share {% endblock %}</h1>

<form method="post">
  {% csrf_token %}
  <div class="field">
    <label class="label">Add your secret and click the button to get unique link</label>
    <div class="control">
      {{ form.as_p }}
    </div>
  </div>

  <div class="field is-grouped">
    <div class="control">
      <button class="button is-primary is-outlined">Generate Secret Link</button>
    </div>
  </div>
</form>

<div class="block">
  <div class="content is-medium">
    {% if secret_url %}
    <h2 class="title">Copy the link below and share</h2>
    <div class="notification is-info">
      <a href="{{ secret_url }}" id="secret-url">{{ secret_url }}</a>
    </div>
    <div class="control">
      <button class="button is-danger is-outlined" onclick="CopyText()" id="copy-url-button">Copy URL</button>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  function CopyText() {
    const element = document.querySelector('#secret-url');
    const storage = document.createElement('textarea');
    storage.value = element.innerHTML;
    element.appendChild(storage);
    storage.select();
    storage.setSelectionRange(0, 99999);
    document.execCommand('copy');
    element.removeChild(storage);
    const button = document.getElementById("copy-url-button");
    button.value = "Copied";
    button.innerHTML = "Copied";
}
</script>
{% endblock scripts %}